<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Reset Limits - Beauty Showcase</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <meta name="theme-color" content="#000000">
  <style>
    :root {
      --bg: #000;
      --primary: rgba(255,64,129,0.95);
      --primary-hover: rgba(255,64,129,1);
      --text: #fff;
      --text-muted: rgba(255,255,255,0.7);
      --transition: .25s ease;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      padding: 20px;
      text-align: center;
    }
    
    .container {
      max-width: 500px;
      margin: 0 auto;
      width: 100%;
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    
    h1 {
      font-size: 2rem;
      margin-bottom: 20px;
    }
    
    .description {
      margin-bottom: 30px;
      opacity: 0.8;
      line-height: 1.5;
    }
    
    .reset-options {
      display: flex;
      flex-direction: column;
      gap: 15px;
      margin-bottom: 30px;
    }
    
    .reset-btn {
      background: var(--primary);
      border: none;
      padding: 15px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition);
      font-size: 1rem;
    }
    
    .reset-btn:hover {
      background: var(--primary-hover);
      transform: translateY(-2px);
    }
    
    .reset-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }
    
    .stats {
      margin-top: 30px;
      font-size: 0.9rem;
      opacity: 0.7;
    }
    
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.9);
      z-index: 100;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    
    .modal.active {
      opacity: 1;
      pointer-events: all;
    }
    
    .modal-content {
      max-width: 400px;
      width: 100%;
      background: #111;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }
    
    .modal h2 {
      margin-bottom: 15px;
    }
    
    .modal p {
      margin-bottom: 20px;
      opacity: 0.8;
    }
    
    .modal-btn {
      background: var(--primary);
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all var(--transition);
    }
    
    .modal-btn:hover {
      background: var(--primary-hover);
    }
    
    .timer {
      font-size: 1.2rem;
      margin: 15px 0;
      font-weight: bold;
    }
    
    .ad-info {
      margin: 20px 0;
      padding: 15px;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
    }
    
    .verification-status {
      margin: 15px 0;
      min-height: 24px;
    }
    
    .warning {
      color: #ff9e9e;
      font-weight: 600;
    }
    
    @media (max-width: 600px) {
      h1 {
        font-size: 1.6rem;
      }
      
      .reset-btn {
        padding: 12px;
        font-size: 0.95rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Reset Your Limits</h1>
    <p class="description">
      You've reached your daily limits. Visit the sponsor link for at least 10 seconds to reset your limits.
      Each reset requires more sponsor visits than the last.
    </p>
    
    <div class="reset-options">
      <button class="reset-btn" id="resetLikesBtn">Reset Likes Limit</button>
      <button class="reset-btn" id="resetScrollsBtn">Reset Scrolls Limit</button>
    </div>
    
    <div class="stats">
      <div id="likesStats">Likes resets today: 0</div>
      <div id="scrollsStats">Scrolls resets today: 0</div>
      <div id="nextCost">Next reset requires: 1 visit</div>
    </div>
  </div>
  
  <!-- Verification Modal -->
  <div class="modal" id="verificationModal">
    <div class="modal-content">
      <h2>Verification in Progress</h2>
      <div class="ad-info">
        <p>We're verifying your visit to the sponsor page.</p>
        <p>Please keep the sponsor tab open for at least 10 seconds.</p>
        <div class="verification-status" id="verificationStatus">Starting verification...</div>
        <div class="timer" id="timer">0s / 10s</div>
      </div>
      <button class="modal-btn" id="cancelBtn">Cancel</button>
    </div>
  </div>
  
  <!-- Success Modal -->
  <div class="modal" id="successModal">
    <div class="modal-content">
      <h2>Limit Reset Successful!</h2>
      <p id="successMessage"></p>
      <button class="modal-btn" id="returnBtn">Return to Viewer</button>
    </div>
  </div>
  
  <!-- Too Soon Modal -->
  <div class="modal" id="tooSoonModal">
    <div class="modal-content">
      <h2>Verification Failed</h2>
      <p class="warning">You didn't stay on the sponsor page long enough.</p>
      <p>Please try again and keep the sponsor tab open for the full 10 seconds.</p>
      <button class="modal-btn" id="tryAgainBtn">Try Again</button>
    </div>
  </div>

  <script>
    // State
    let resetType = null;
    let sponsorWindow = null;
    let verificationInterval = null;
    let verificationStartTime = null;
    const SPONSOR_URL = "https://otieu.com/4/9515888";
    const VERIFICATION_DURATION = 10000; // 10 seconds
    
    // Load reset counts from localStorage
    const resetData = JSON.parse(localStorage.getItem('beauty_reset_data') || '{}');
    if (!resetData.likes) resetData.likes = { count: 0, lastResetDate: '' };
    if (!resetData.scrolls) resetData.scrolls = { count: 0, lastResetDate: '' };
    
    // Check if it's a new day
    const today = new Date().toISOString().slice(0, 10);
    if (resetData.likes.lastResetDate !== today) {
      resetData.likes.count = 0;
      resetData.likes.lastResetDate = today;
    }
    if (resetData.scrolls.lastResetDate !== today) {
      resetData.scrolls.count = 0;
      resetData.scrolls.lastResetDate = today;
    }
    
    // DOM elements
    const resetLikesBtn = document.getElementById('resetLikesBtn');
    const resetScrollsBtn = document.getElementById('resetScrollsBtn');
    const likesStats = document.getElementById('likesStats');
    const scrollsStats = document.getElementById('scrollsStats');
    const nextCost = document.getElementById('nextCost');
    const verificationModal = document.getElementById('verificationModal');
    const successModal = document.getElementById('successModal');
    const tooSoonModal = document.getElementById('tooSoonModal');
    const verificationStatus = document.getElementById('verificationStatus');
    const timer = document.getElementById('timer');
    const cancelBtn = document.getElementById('cancelBtn');
    const tryAgainBtn = document.getElementById('tryAgainBtn');
    const returnBtn = document.getElementById('returnBtn');
    const successMessage = document.getElementById('successMessage');
    
    // Update UI with current stats
    function updateStats() {
      likesStats.textContent = `Likes resets today: ${resetData.likes.count}`;
      scrollsStats.textContent = `Scrolls resets today: ${resetData.scrolls.count}`;
      
      const totalResets = resetData.likes.count + resetData.scrolls.count;
      const requiredVisits = Math.min(1 + totalResets, 10);
      nextCost.textContent = `Next reset requires: ${requiredVisits} visit${requiredVisits > 1 ? 's' : ''}`;
    }
    
    // Reset button handlers
    resetLikesBtn.addEventListener('click', () => {
      resetType = 'likes';
      startVerificationProcess();
    });
    
    resetScrollsBtn.addEventListener('click', () => {
      resetType = 'scrolls';
      startVerificationProcess();
    });
    
    // Start the verification process
    function startVerificationProcess() {
      // Disable buttons during verification
      resetLikesBtn.disabled = true;
      resetScrollsBtn.disabled = true;
      
      // Open sponsor URL in new tab with noopener
      sponsorWindow = window.open(SPONSOR_URL, '_blank', 'noopener,noreferrer');
      
      // Start verification
      verificationModal.classList.add('active');
      verificationStartTime = Date.now();
      updateVerificationStatus(0);
      
      // Begin checking
      verificationInterval = setInterval(checkVerification, 1000);
    }
    
    // Check verification status
    function checkVerification() {
      const elapsed = Date.now() - verificationStartTime;
      const seconds = Math.floor(elapsed / 1000);
      
      try {
        // Try to access the sponsor window's URL
        if (sponsorWindow && !sponsorWindow.closed) {
          // This will throw an error due to cross-origin policy if still on sponsor site
          sponsorWindow.location.href;
          
          // If we get here, they've returned to our domain or a blank page
          handleVerificationFailed();
          return;
        }
      } catch (e) {
        // Cross-origin error means still on sponsor site - this is good
        updateVerificationStatus(seconds);
        
        // Check if verification period is complete
        if (elapsed >= VERIFICATION_DURATION) {
          handleVerificationSuccess();
        }
        return;
      }
      
      // If window is closed or other error
      handleVerificationFailed();
    }
    
    // Update verification status display
    function updateVerificationStatus(seconds) {
      timer.textContent = `${seconds}s / 10s`;
      
      if (seconds < 3) {
        verificationStatus.textContent = "Verifying sponsor visit...";
      } else if (seconds < 7) {
        verificationStatus.textContent = "Please keep the sponsor tab open...";
      } else {
        verificationStatus.textContent = "Almost done...";
      }
    }
    
    // Handle successful verification
    function handleVerificationSuccess() {
      clearInterval(verificationInterval);
      verificationModal.classList.remove('active');
      
      // Calculate how many resets they get (halved each time)
      const totalResets = resetData.likes.count + resetData.scrolls.count;
      const resetsGranted = Math.max(2, Math.floor(10 / (1 + totalResets)));
      
      // Update reset data
      resetData[resetType].count++;
      resetData[resetType].lastResetDate = today;
      localStorage.setItem('beauty_reset_data', JSON.stringify(resetData));
      
      // Update the identity data to reset the appropriate limit
      const identity = JSON.parse(localStorage.getItem('beauty_identity') || {});
      
      if (resetType === 'likes') {
        identity.likesToday = Math.max(0, identity.likesToday - resetsGranted);
        successMessage.textContent = `Your likes limit has been extended by ${resetsGranted}.`;
      } else {
        identity.scrollsToday = Math.max(0, identity.scrollsToday - resetsGranted);
        successMessage.textContent = `Your scrolls limit has been extended by ${resetsGranted}.`;
      }
      
      localStorage.setItem('beauty_identity', JSON.stringify(identity));
      
      // Show success modal
      successModal.classList.add('active');
      
      // Close sponsor window if still open
      if (sponsorWindow && !sponsorWindow.closed) {
        sponsorWindow.close();
      }
    }
    
    // Handle failed verification
    function handleVerificationFailed() {
      clearInterval(verificationInterval);
      verificationModal.classList.remove('active');
      tooSoonModal.classList.add('active');
      
      // Close sponsor window if still open
      if (sponsorWindow && !sponsorWindow.closed) {
        sponsorWindow.close();
      }
      
      // Re-enable buttons
      resetLikesBtn.disabled = false;
      resetScrollsBtn.disabled = false;
    }
    
    // Cancel button handler
    cancelBtn.addEventListener('click', () => {
      clearInterval(verificationInterval);
      verificationModal.classList.remove('active');
      
      // Close sponsor window if still open
      if (sponsorWindow && !sponsorWindow.closed) {
        sponsorWindow.close();
      }
      
      // Re-enable buttons
      resetLikesBtn.disabled = false;
      resetScrollsBtn.disabled = false;
    });
    
    // Try again button handler
    tryAgainBtn.addEventListener('click', () => {
      tooSoonModal.classList.remove('active');
      startVerificationProcess();
    });
    
    // Return button handler
    returnBtn.addEventListener('click', () => {
      successModal.classList.remove('active');
      updateStats();
      window.location.href = 'viewer.html';
    });
    
    // Initialize
    updateStats();
  </script>
</body>
</html>