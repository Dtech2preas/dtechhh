<!DOCTYPE html>
<html>
<head>
  <title>Mini HTTrack (One Page Copier with CORS Fix)</title>
  <style>
    body { font-family: monospace; padding: 1rem; }
    input, button { font-size: 1rem; }
    textarea { width: 100%; height: 300px; margin-top: 1rem; }
  </style>
</head>
<body>
  <h2>üï∏Ô∏è One-Page Website Copier (with CORS Proxy)</h2>
  <input id="urlInput" placeholder="Enter site URL (e.g. https://example.com)" size="60">
  <button onclick="copySite()">Copy Homepage</button>
  <br>
  <textarea id="output" placeholder="Copied HTML will appear here..."></textarea>

  <script>
    const proxy = "https://api.allorigins.win/raw?url=";

    async function inlineCSS(doc, baseUrl) {
      const links = Array.from(doc.querySelectorAll('link[rel="stylesheet"]'));
      for (const link of links) {
        try {
          const cssUrl = new URL(link.getAttribute('href'), baseUrl).href;
          const cssText = await (await fetch(proxy + encodeURIComponent(cssUrl))).text();
          const style = document.createElement('style');
          style.textContent = cssText;
          link.replaceWith(style);
        } catch (e) {
          console.warn("Failed to inline CSS:", link.href);
        }
      }
    }

    async function inlineImages(doc, baseUrl) {
      const images = Array.from(doc.querySelectorAll('img'));
      for (const img of images) {
        try {
          const imgUrl = new URL(img.getAttribute('src'), baseUrl).href;
          const response = await fetch(proxy + encodeURIComponent(imgUrl));
          const blob = await response.blob();
          const base64 = await new Promise((resolve) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result);
            reader.readAsDataURL(blob);
          });
          img.src = base64;
        } catch (e) {
          console.warn("Failed to inline image:", img.src);
        }
      }
    }

    async function copySite() {
      const url = document.getElementById('urlInput').value;
      const output = document.getElementById('output');
      output.value = "Fetching...";

      try {
        const res = await fetch(proxy + encodeURIComponent(url));
        const html = await res.text();

        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');

        await inlineCSS(doc, url);
        await inlineImages(doc, url);

        output.value = "<!DOCTYPE html>\n" + doc.documentElement.outerHTML;
      } catch (err) {
        output.value = '‚ùå Error: ' + err.message;
      }
    }
  </script>
</body>
</html>