<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HTML to Live Website Converter</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #2563eb;
    --primary-hover: #1d4ed8;
    --success: #10b981;
    --error: #ef4444;
    --bg: #f8fafc;
    --card: #ffffff;
    --text: #1e293b;
    --text-light: #64748b;
    --border: #e2e8f0;
  }
  
  body {
    font-family: 'Inter', sans-serif;
    background-color: var(--bg);
    color: var(--text);
    margin: 0;
    padding: 2rem;
    line-height: 1.5;
  }
  
  .container {
    max-width: 1200px;
    margin: 0 auto;
  }
  
  h1 {
    color: var(--primary);
    font-weight: 600;
    margin-bottom: 1.5rem;
    text-align: center;
  }
  
  .card {
    background-color: var(--card);
    border-radius: 0.5rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    padding: 2rem;
    margin-bottom: 2rem;
  }
  
  label {
    display: block;
    font-weight: 500;
    margin-bottom: 0.5rem;
  }
  
  input {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid var(--border);
    border-radius: 0.375rem;
    font-size: 1rem;
    margin-bottom: 1rem;
  }
  
  input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
  }
  
  button {
    background-color: var(--primary);
    color: white;
    border: none;
    border-radius: 0.375rem;
    padding: 0.75rem 1.5rem;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: background-color 0.2s;
    width: 100%;
    margin-top: 1rem;
  }
  
  button:hover {
    background-color: var(--primary-hover);
  }
  
  button:disabled {
    background-color: var(--text-light);
    cursor: not-allowed;
  }
  
  .preview-container {
    border: 1px solid var(--border);
    border-radius: 0.375rem;
    margin: 1.5rem 0;
    overflow: hidden;
  }
  
  .preview-header {
    background-color: var(--bg);
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--border);
    font-weight: 500;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .preview-content {
    max-height: 400px;
    overflow: auto;
    padding: 1rem;
    background-color: white;
    font-family: monospace;
    white-space: pre-wrap;
  }
  
  .result-container {
    display: none;
    margin-top: 2rem;
  }
  
  .result-card {
    background-color: var(--success);
    color: white;
    padding: 1rem;
    border-radius: 0.375rem;
    margin-bottom: 1rem;
  }
  
  .url-container {
    background-color: var(--card);
    border: 1px solid var(--border);
    border-radius: 0.375rem;
    padding: 1rem;
    margin-bottom: 1rem;
    word-break: break-all;
  }
  
  .url-label {
    font-weight: 500;
    color: var(--text-light);
    margin-bottom: 0.5rem;
    display: block;
  }
  
  .url-link {
    color: var(--primary);
    text-decoration: none;
  }
  
  .url-link:hover {
    text-decoration: underline;
  }
  
  .status {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin: 1rem 0;
    font-weight: 500;
  }
  
  .spinner {
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    border-top: 2px solid var(--primary);
    width: 16px;
    height: 16px;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .step {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }
  
  .step-number {
    background-color: var(--primary);
    color: white;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.875rem;
  }
  
  .step-text {
    font-weight: 500;
  }
  
  .step.completed .step-number {
    background-color: var(--success);
  }
  
  .history-item {
    border: 1px solid var(--border);
    border-radius: 0.375rem;
    padding: 1rem;
    margin-bottom: 1rem;
  }
  
  .history-item-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
  }
  
  .commit-sha {
    font-family: monospace;
    background-color: var(--bg);
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
  }
  
  .timestamp {
    color: var(--text-light);
    font-size: 0.875rem;
  }
</style>
</head>
<body>

<div class="container">
  <h1>HTML to Live Website Converter</h1>
  
  <div class="card">
    <h2>Step 1: Authentication</h2>
    <label for="token">GitHub Personal Access Token (with gist scope)</label>
    <input type="password" id="token" placeholder="Enter your GitHub token" autocomplete="off" />
    <p style="color: var(--text-light); font-size: 0.875rem;">
      Need a token? <a href="https://github.com/settings/tokens/new?description=Gist%20Uploader&scopes=gist" target="_blank">Create one here</a>
    </p>
  </div>
  
  <div class="card">
    <h2>Step 2: Verify Your HTML</h2>
    <p>We've automatically loaded your HTML from localStorage (data2step):</p>
    
    <div class="preview-container">
      <div class="preview-header">
        <span>HTML Preview</span>
        <span id="html-length"></span>
      </div>
      <div class="preview-content" id="htmlPreview"></div>
    </div>
    
    <div class="status" id="htmlStatus">
      <div class="spinner" id="htmlSpinner"></div>
      <span id="htmlStatusText">Checking HTML content...</span>
    </div>
  </div>
  
  <div class="card">
    <h2>Step 3: Upload & Convert</h2>
    <p>Upload your HTML to GitHub Gist and get a live-rendering URL:</p>
    <button id="uploadBtn">Upload & Generate Live URL</button>
    
    <div class="status" id="uploadStatus" style="display: none;">
      <div class="spinner"></div>
      <span id="uploadStatusText">Uploading to GitHub...</span>
    </div>
  </div>
  
  <div class="result-container" id="resultContainer">
    <div class="result-card">
      <h2>üéâ Success! Your website is live</h2>
      <p>Here are your links:</p>
    </div>
    
    <div class="step completed">
      <div class="step-number">1</div>
      <div class="step-text">HTML loaded from localStorage</div>
    </div>
    
    <div class="step completed">
      <div class="step-number">2</div>
      <div class="step-text">Uploaded to GitHub Gist</div>
    </div>
    
    <div class="step completed">
      <div class="step-number">3</div>
      <div class="step-text">Converted to live website</div>
    </div>
    
    <div class="url-container">
      <span class="url-label">Gist URL (GitHub):</span>
      <a href="#" class="url-link" id="gistUrl" target="_blank"></a>
    </div>
    
    <div class="url-container">
      <span class="url-label">Commit SHA (for version tracking):</span>
      <span id="commitSha" class="commit-sha"></span>
    </div>
    
    <div class="url-container">
      <span class="url-label">Live Website URL (commit-specific):</span>
      <a href="#" class="url-link" id="liveUrl" target="_blank"></a>
    </div>
    
    <button id="copyLiveUrl" style="background-color: var(--success);">Copy Live URL</button>
  </div>
  
  <div class="card" id="historyContainer" style="display: none;">
    <h2>Upload History</h2>
    <div id="historyList"></div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', async () => {
  const tokenInput = document.getElementById('token');
  const htmlPreview = document.getElementById('htmlPreview');
  const htmlLength = document.getElementById('html-length');
  const htmlStatus = document.getElementById('htmlStatus');
  const htmlStatusText = document.getElementById('htmlStatusText');
  const htmlSpinner = document.getElementById('htmlSpinner');
  const uploadBtn = document.getElementById('uploadBtn');
  const uploadStatus = document.getElementById('uploadStatus');
  const uploadStatusText = document.getElementById('uploadStatusText');
  const resultContainer = document.getElementById('resultContainer');
  const gistUrl = document.getElementById('gistUrl');
  const liveUrl = document.getElementById('liveUrl');
  const commitSha = document.getElementById('commitSha');
  const copyLiveUrl = document.getElementById('copyLiveUrl');
  const historyContainer = document.getElementById('historyContainer');
  const historyList = document.getElementById('historyList');
  
  // Load upload history from localStorage
  let uploadHistory = JSON.parse(localStorage.getItem('gistUploadHistory') || [];
  
  // Load HTML from localStorage
  const savedHtml = localStorage.getItem('data2step');
  
  if (!savedHtml) {
    htmlSpinner.style.display = 'none';
    htmlStatusText.innerHTML = `<span style="color: ${getComputedStyle(document.documentElement).getPropertyValue('--error')}">‚ùå No HTML found in localStorage at key 'data2step'</span>`;
    uploadBtn.disabled = true;
    return;
  }
  
  // Display the full HTML content
  htmlPreview.textContent = savedHtml;
  htmlLength.textContent = `${savedHtml.length} characters`;
  
  // Immediately validate HTML content (no setTimeout needed)
  htmlSpinner.style.display = 'none';
  if (savedHtml.includes('<html') && savedHtml.includes('</html>')) {
    htmlStatusText.innerHTML = `<span style="color: ${getComputedStyle(document.documentElement).getPropertyValue('--success')}">‚úì Valid HTML document loaded</span>`;
  } else {
    htmlStatusText.innerHTML = `<span style="color: ${getComputedStyle(document.documentElement).getPropertyValue('--error')}">‚ö† This doesn't look like a complete HTML document (missing html tags)</span>`;
  }
  
  // Render upload history if any exists
  if (uploadHistory.length > 0) {
    historyContainer.style.display = 'block';
    renderHistory();
  }
  
  // Upload button click handler
  uploadBtn.addEventListener('click', async () => {
    const token = tokenInput.value.trim();
    
    if (!token) {
      alert('Please enter your GitHub token');
      return;
    }
    
    uploadBtn.disabled = true;
    uploadStatus.style.display = 'flex';
    uploadStatusText.textContent = 'Uploading to GitHub...';
    
    try {
      // Step 1: Create the Gist
      uploadStatusText.textContent = 'Creating GitHub Gist...';
      const gistResponse = await fetch('https://api.github.com/gists', {
        method: 'POST',
        headers: {
          'Authorization': `token ${token}`,
          'Accept': 'application/vnd.github.v3+json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          description: 'Live website created via HTML Converter - ' + new Date().toLocaleString(),
          public: true,
          files: {
            'index.html': {
              content: savedHtml
            }
          }
        })
      });
      
      const gistData = await gistResponse.json();
      
      if (!gistData.id) {
        throw new Error(gistData.message || 'Failed to create gist');
      }
      
      // Step 2: Get the specific commit SHA
      uploadStatusText.textContent = 'Getting commit details...';
      const commitsResponse = await fetch(`https://api.github.com/gists/${gistData.id}/commits`, {
        headers: {
          'Authorization': `token ${token}`,
          'Accept': 'application/vnd.github.v3+json'
        }
      });
      
      const commitsData = await commitsResponse.json();
      const latestCommit = commitsData[0];
      const commitShaValue = latestCommit.version;
      
      // Step 3: Generate URLs
      uploadStatusText.textContent = 'Generating live URL...';
      const gistUrlValue = gistData.html_url;
      const liveUrlValue = `https://gist.githack.com/${gistData.owner.login}/${gistData.id}/raw/${commitShaValue}/index.html`;
      
      // Display results
      gistUrl.textContent = gistUrlValue;
      gistUrl.href = gistUrlValue;
      liveUrl.textContent = liveUrlValue;
      liveUrl.href = liveUrlValue;
      commitSha.textContent = commitShaValue;
      
      // Add to history
      const historyItem = {
        gistId: gistData.id,
        commitSha: commitShaValue,
        gistUrl: gistUrlValue,
        liveUrl: liveUrlValue,
        timestamp: new Date().toISOString(),
        htmlPreview: savedHtml.length > 100 ? savedHtml.substring(0, 100) + '...' : savedHtml
      };
      
      uploadHistory.unshift(historyItem);
      localStorage.setItem('gistUploadHistory', JSON.stringify(uploadHistory));
      
      // Show results and history
      resultContainer.style.display = 'block';
      historyContainer.style.display = 'block';
      uploadStatus.style.display = 'none';
      renderHistory();
      
      // Scroll to results
      setTimeout(() => {
        resultContainer.scrollIntoView({ behavior: 'smooth' });
      }, 300);
      
    } catch (err) {
      uploadStatus.innerHTML = `<span style="color: ${getComputedStyle(document.documentElement).getPropertyValue('--error')}">Error: ${err.message}</span>`;
      uploadBtn.disabled = false;
    }
  });
  
  // Copy URL button
  copyLiveUrl.addEventListener('click', () => {
    navigator.clipboard.writeText(liveUrl.href);
    const originalText = copyLiveUrl.textContent;
    copyLiveUrl.textContent = 'Copied!';
    copyLiveUrl.style.backgroundColor = 'var(--success)';
    setTimeout(() => {
      copyLiveUrl.textContent = originalText;
    }, 2000);
  });
  
  // Render upload history
  function renderHistory() {
    historyList.innerHTML = '';
    uploadHistory.forEach((item, index) => {
      const historyItem = document.createElement('div');
      historyItem.className = 'history-item';
      
      const date = new Date(item.timestamp);
      const formattedDate = date.toLocaleString();
      
      historyItem.innerHTML = `
        <div class="history-item-header">
          <strong>Upload #${uploadHistory.length - index}</strong>
          <span class="timestamp">${formattedDate}</span>
        </div>
        <div style="margin-bottom: 0.5rem;">
          <span class="url-label">Commit SHA:</span>
          <span class="commit-sha">${item.commitSha}</span>
        </div>
        <div style="margin-bottom: 0.5rem;">
          <span class="url-label">Live URL:</span>
          <a href="${item.liveUrl}" class="url-link" target="_blank">${item.liveUrl}</a>
        </div>
        <details>
          <summary>HTML Preview</summary>
          <div style="max-height: 100px; overflow: auto; border: 1px solid var(--border); padding: 0.5rem; margin-top: 0.5rem; background: white; font-family: monospace;">
            ${escapeHtml(item.htmlPreview)}
          </div>
        </details>
      `;
      
      historyList.appendChild(historyItem);
    });
  }
  
  // Helper function to escape HTML
  function escapeHtml(unsafe) {
    return unsafe
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }
});
</script>

</body>
</html>